---
title: "R Notebook"
output: html_notebook
---


```{r eval=FALSE, include=FALSE}
if (!require(magrittr)) {
  install.packages("magrittr", repos = "http://cran.us.r-project.org")
  require(magrittr)
}
if (!require(stringr)) {
  install.packages("stringr", repos = "http://cran.us.r-project.org")
  require(stringr)
}
if (!require(dplyr)) {
  install.packages("dplyr", repos = "http://cran.us.r-project.org")
  require(dplyr)
}
if (!require(ggplot2)) {
  install.packages("ggplot2", repos = "http://cran.us.r-project.org")
  require(ggplot2)
}
if (!require(tm)) {
  install.packages("tm", repos = "http://cran.us.r-project.org")
  require(tm)
}
if (!require(wordcloud)) {
  install.packages("wordcloud", repos = "http://cran.us.r-project.org")
  require(wordcloud)
}
if (!require(syuzhet)) {
  install.packages("syuzhet", repos = "http://cran.us.r-project.org")
  require(syuzhet)
}
if (!require(tidytext)) {
  install.packages("tidytext", repos = "http://cran.us.r-project.org")
  require(tidytext)
}
if (!require(tidyr)) {
  install.packages("tidyr", repos = "http://cran.us.r-project.org")
  require(tidyr)
}
if (!require(igraph)) {
  install.packages("igraph", repos = "http://cran.us.r-project.org")
  require(igraph)
}
if (!require(ggraph)) {
  install.packages("ggraph", repos = "http://cran.us.r-project.org")
  require(ggraph)
}
if (!require(readr)) {
  install.packages("readr", repos = "http://cran.us.r-project.org")
  require(readr)
}
if (!require(circlize)) {
  install.packages("circlize", repos = "http://cran.us.r-project.org")
  require(circlize)
}
if (!require(reshape2)) {
  install.packages("reshape2", repos = "http://cran.us.r-project.org")
  require(reshape2)
}
```


```{r}
lyrics_text <- lyrics$lyric
#Removing punctations and alphanumeric content
lyrics_text<- gsub('[[:punct:]]+', '', lyrics_text)
lyrics_text<- gsub("([[:alpha:]])\1+", "", lyrics_text)
# Getting the sentiment value for the lyrics
ty_sentiment <- get_nrc_sentiment((lyrics_text))

# Dataframe with cumulative value of the sentiments
sentimentscores<-data.frame(colSums(ty_sentiment[,]))

# Dataframe with sentiment and score as columns
names(sentimentscores) <- "Score"
sentimentscores <- cbind("sentiment"=rownames(sentimentscores),sentimentscores)
rownames(sentimentscores) <- NULL

```




```{r}

# Plot for the cumulative sentiments
ggplot(data=sentimentscores,aes(x=sentiment,y=Score, label=Score))+
geom_bar(aes(fill=sentiment),stat = "identity")+
geom_text(vjust= -1) +
theme(legend.position="none")+
xlab("Types of Sentiments")+ylab("Scores") + ylim(0,1750)+
ggtitle("Sentiment Score Distribution")+
theme(axis.text.x=element_text(size=10)) 
```
```{r}
lyrics$lyric <- as.character(lyrics$lyric)

tidy_lyrics <- lyrics %>% 
unnest_tokens(word,lyric)

song_wrd_count <- tidy_lyrics %>% count(track_title)

lyric_counts <- tidy_lyrics %>%
left_join(song_wrd_count, by = "track_title") %>% 
rename(total_words=n)

lyric_sentiment <- tidy_lyrics %>% 
inner_join(get_sentiments("nrc"),by="word")

lyric_sentiment %>% 
count(word,sentiment,sort=TRUE) %>% 
group_by(sentiment)%>%top_n(n=10) %>% 
ungroup() %>%
ggplot(aes(x=reorder(word,n),y=n,fill=sentiment)) +
geom_col(show.legend = FALSE) + 
facet_wrap(~sentiment,scales="free") +
xlab("Sentiments") + ylab("Scores")+
ggtitle("Top words used to express emotions and sentiments") +
coord_flip()
```





```{r}

lyric_sentiment <- tidy_lyrics %>% 
inner_join(get_sentiments("nrc"),by="word")

grid.col = c("2006" = "#E69F00", "2008" = "#56B4E9", "2010" = "#009E73", "2012" = "#CC79A7", "2014" = "#D55E00", "2017" = "#00D6C9", "anger" = "grey", "anticipation" = "grey", "disgust" = "grey", "fear" = "grey", "joy" = "grey", "sadness" = "grey", "surprise" = "grey", "trust" = "grey")

year_emotion <- lyric_sentiment %>%
filter(!sentiment %in% c("positive", "negative")) %>%
count(sentiment, year) %>%
group_by(year, sentiment) %>%
summarise(sentiment_sum = sum(n)) %>%
ungroup()

#Reset the circular layout parameters
circos.clear()

#Setting the gap size
circos.par(gap.after = c(rep(6, length(unique(year_emotion[[1]])) - 1), 15,
rep(6, length(unique(year_emotion[[2]])) - 1), 15))

chordDiagram(year_emotion, grid.col = grid.col, transparency = .2)
title("Relationship between emotion and song's year of release")
```




